var pgSiteSearch={ASObject:null,upOrDown:!1,siteCode:null,defaultTitle:"例如：必应",defaultUrl:"例如：cn.bing.com",isTitleClickFirst:!1,isUrlClickFirst:!1,ASMaxNumber:null,stopEvent:function(n){sj_sp(n),sj_pd(n)},withinNodeByID:function(n,t){return sj_we(n,_ge(t))?_ge(t):!1},withinNodeByStyle:function(n,t){for(var r=!1,i=n;i&&!r;)t&&i.className&&(i.className==t||i.className.indexOf(t)!=-1)?r=i:i=i.parentNode;return i},handleKeyPress:function(n){var i=sj_ev(n),u=sj_et(i),r=pgSiteSearch.withinNodeByID(u,"in_tl"),t=i.keyCode;pgSiteSearch.ASObject&&t==13?(pgSiteSearch.ASObject.isSelected=!0,pgSiteSearch.ASObject.isSafari&&pgSiteSearch.ASObject.inputBox&&pgSiteSearch.ASObject.inputBox.blur(),pgSiteSearch.hideASFloater()):r&&t!=38&&t!=40&&t!=37&&t!=39&&t!=13&&t!=27&&(t==8&&pgSiteSearch.ASObject.inputBox.value==""?pgSiteSearch.hideASFloater():pgSiteSearch.processAS(r),pgSiteSearch.upOrDown=!1)},handleKeyDown:function(n){var i=sj_ev(n),r=i.keyCode,t,u;pgSiteSearch.ASObject&&r&&(r==13?(pgSiteSearch.upOrDown&&(t=pgSiteSearch.getSelectedItem())!=null&&(u=pgSiteSearch.ASObject.titleList[t].value,pgSiteSearch.ASObject.inputBox.value=u,_ge("in_url").value=pgSiteSearch.ASObject.urlList[t].value,this.isUrlClickFirst=!0,_ge("in_url").className="input_InputBox",pgSiteSearch.hideASFloater()),pgSiteSearch.ASObject.isSelected=!0):r==40?(pgSiteSearch.ASObject.isSelected=!0,pgSiteSearch.stopEvent(i),pgSiteSearch.ASObject.isGecko&&pgSiteSearch.ASObject.inputBox.blur(),pgSiteSearch.selectNextSDAS_MatchItem(),pgSiteSearch.upOrDown=!0,(t=pgSiteSearch.getSelectedItem())!=null&&(u=pgSiteSearch.ASObject.titleList[t].value,pgSiteSearch.ASObject.inputBox.value=u,_ge("in_url").value=pgSiteSearch.ASObject.urlList[t].value,this.isUrlClickFirst=!0,_ge("in_url").className="input_InputBox")):r==38?(pgSiteSearch.ASObject.isSelected=!0,pgSiteSearch.stopEvent(i),pgSiteSearch.ASObject.isGecko&&pgSiteSearch.ASObject.inputBox.blur(),pgSiteSearch.selectPreviousSDAS_MatchItem(),pgSiteSearch.upOrDown=!0,(t=pgSiteSearch.getSelectedItem())!=null&&(u=pgSiteSearch.ASObject.titleList[t].value,pgSiteSearch.ASObject.inputBox.value=u,_ge("in_url").value=pgSiteSearch.ASObject.urlList[t].value,this.isUrlClickFirst=!0,_ge("in_url").className="input_InputBox")):r==27?(pgSiteSearch.hideASFloater(),pgSiteSearch.stopEvent(i)):r==9?(pgSiteSearch.hideASFloater(),pgSiteSearch.stopEvent(i),_ge("in_url").value==pgSiteSearch.defaultUrl&&(_ge("in_url").value="",_ge("in_url").className="input_InputBox"),pgSiteSearch.isUrlClickFirst=!0,_ge("in_url").focus()):pgSiteSearch.ASObject&&pgSiteSearch.ASObject.inputBox&&(pgSiteSearch.ASObject.isSelected=!1),sj_sp(i))},handleBeginItem:function(n){var t=sj_ev(n),i=sj_et(t);pgSiteSearch.ASObject&&(pgSiteSearch.ASObject.isSelected=!0,pgSiteSearch.upOrDown?pgSiteSearch.fillInputBox():pgSiteSearch.searchNoupOrDown(),pgSiteSearch.stopEvent(t),Log.Log("DHTMLClick","","ASDLCNClickBox",!0,"clickit",1))},handleClick:function(n){var t=sj_ev(n),i=sj_et(t),r,u;pgSiteSearch.ASObject&&(pgSiteSearch.withinNodeByStyle(i,"as_Item")?(pgSiteSearch.upOrDown=!0,t.which&&t.which==1?pgSiteSearch.selectFromMouseClickInMatchItem():t.button&&t.button==1&&pgSiteSearch.selectFromMouseClickInMatchItem(),_ge("as_lt").style.display="none"):pgSiteSearch.withinNodeByID(i,"in_tl")||(pgSiteSearch.selectFromMouseClickOutOfMatchItem(),_ge("in_tl").value==""&&(_ge("in_tl").value=pgSiteSearch.defaultTitle,_ge("in_tl").className="default_InputBox",pgSiteSearch.isTitleClickFirst=!1),pgSiteSearch.withinNodeByID(i,"in_url")||_ge("in_url").value!=""||(_ge("in_url").value=pgSiteSearch.defaultUrl,_ge("in_url").className="default_InputBox",pgSiteSearch.isUrlClickFirst=!1),pgSiteSearch.hideASFloater())),r=pgSiteSearch.withinNodeByID(i,"in_tl"),r&&(pgSiteSearch.isTitleClickFirst||_ge("in_tl").value!=pgSiteSearch.defaultTitle||(pgSiteSearch.isTitleClickFirst=!0,_ge("in_tl").value="",_ge("in_tl").className="input_InputBox")),u=pgSiteSearch.withinNodeByID(i,"in_url"),u&&(pgSiteSearch.isUrlClickFirst||_ge("in_url").value!=pgSiteSearch.defaultUrl||(pgSiteSearch.isUrlClickFirst=!0,_ge("in_url").value="",_ge("in_url").className="input_InputBox"))},handleMouseOver:function(n){var t=sj_ev(n),i=sj_et(t);pgSiteSearch.ASObject&&(mEl=pgSiteSearch.withinNodeByStyle(i,"as_Item"))&&(pgSiteSearch.ASObject.isSelected=!0,pgSiteSearch.selectFromMouseOver(mEl))},showASFloater:function(){var n=pgSiteSearch.ASObject.inputBox.value;n&&n!=""&&n!='"'&&(_ge("as_lt").style.borderBottomStyle="solid"),pgSiteSearch.ASObject.floater.style.display="block"},hideASFloater:function(){pgSiteSearch.ASObject&&(pgSiteSearch.ASObject.floater.style.display="none",_ge("as_lt").style.borderBottomStyle="none",pgSiteSearch.ASObject.titleList=null)},createASItem:function(n){this.value=n,this.isSelected=!1},onlySpace:function(n){var t=/^\s*|\s*$/g;return n.replace(t,"")},processAS:function(n){pgSiteSearch.ASObject||(pgSiteSearch.ASObject=new pgSiteSearch.ASWindow),pgSiteSearch.ASObject.inputBox=n,pgSiteSearch.ASObject&&(userInput=pgSiteSearch.ASObject.inputBox.value,userInput&&userInput!=""&&userInput!='"'&&pgSiteSearch.onlySpace(userInput)!=""&&pgSiteSearch.ASObject&&this.SendRequestToServer(userInput))},SendRequestToServer:function(n){var i="JsonpId",t=_ge(i),r=document.getElementsByTagName("head").item(0),u;t&&r.removeChild(t),u="http://bj1.api.bing.com/qsonhs.aspx?FORM=ASAPIH&mkt=zh-CN&type=cb&cb=pgSiteSearch.apiCB&cp=0&o=u&q="+pgSiteSearch.siteCode+encodeURIComponent(n)+"&ds=localsegment&cp=0&o=u",t=document.createElement("script"),t.setAttribute("type","text/javascript"),t.setAttribute("id",i),r.appendChild(t),t.setAttribute("src",u)},apiCB:function(n){var u=[],i,t,r,f;if(n.AS&&n.AS.Results&&n.AS.Results.length>0&&n.AS.Results[0].Suggests&&n.AS.Results[0].Suggests.length>0)for(i=n.AS.Results[0].Suggests,t=0;t<i.length&&t<pgSiteSearch.ASObject.ASMaxNumber;t++)r=i[t].Txt,r&&r.length>1&&(u.push(pgSiteSearch.truncateTxt(r)),f=i[t].Url,u.push(pgSiteSearch.tempTruncateURL(f)));pgSiteSearch.getQueryAndUrl(u)},tempTruncateURL:function(n){var t=n.indexOf("&");return t==-1?n:n.substring(0,t)},truncateTxt:function(n){var i=0,r=0,t;if(n.length<=26)return n;while(i<=26&&r<n.length)t=n.charCodeAt(r),i=t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||t<32?i+.5:i+1,r++;return n=n.substring(0,r)},getQueryAndUrl:function(n){var t,r,u;for(pgSiteSearch.ASObject&&(pgSiteSearch.ASObject.titleList=null,pgSiteSearch.ASObject.urlList=null,pgSiteSearch.ASObject.titleList=[],pgSiteSearch.ASObject.urlList=[]),t=null,r=null,i=0,j=0;i<n.length;i++)r=n[i],i++,t=n[i],pgSiteSearch.ASObject.titleList[j]=new pgSiteSearch.createASItem(r),pgSiteSearch.ASObject.urlList[j]=new pgSiteSearch.createASItem(t),j++;u=pgSiteSearch.setASFormat(),u?(pgSiteSearch.ASObject.floater.innerHTML='<div class="as_list">'+u+"<\/div>",pgSiteSearch.showASFloater()):pgSiteSearch.hideASFloater()},searchNoupOrDown:function(){pgSiteSearch.ASObject.inputBox&&pgSiteSearch.ASObject.titleList.count&&pgSiteSearch.ASObject.inputBox.value==pgSiteSearch.ASObject.titleList[0].value?(_ge("in_tl").value=pgSiteSearch.ASObject.titleList[0].value,pgSiteSearch.isTitleClickFirst=!1,_ge("in_url").value=pgSiteSearch.ASObject.urlList[0].value,pgSiteSearch.isUrlClickFirst=!1):pgSiteSearch.hideASFloater()},setASFormat:function(){var n=null;if(pgSiteSearch.ASObject&&pgSiteSearch.ASObject.titleList&&pgSiteSearch.ASObject.titleList.length>0)for(n="",i=0;i<pgSiteSearch.ASObject.titleList.length;i++)selectedString=pgSiteSearch.ASObject.titleList[i].isSelected?" selectedAS_Item":"",n+=selectedString?'<p id="AS_ItemID" class="as_Item'+selectedString+'">'+pgSiteSearch.ASObject.titleList[i].value+'<br><span style="color:#aaa">'+pgSiteSearch.ASObject.urlList[i].value+"<\/span><\/p>":'<p id="AS_ItemID" class="as_Item">'+pgSiteSearch.ASObject.titleList[i].value+'<br><span style="color:#aaa">'+pgSiteSearch.ASObject.urlList[i].value+"<\/span><\/p>";return n},selectFromMouseOver:function(n){currentIndex=pgSiteSearch.getSelectedItem(),currentIndex!=null&&pgSiteSearch.setUnselectedItem(currentIndex),newIndex=pgSiteSearch.getIndexFromElement(n),pgSiteSearch.setSelectedItem(newIndex);var t=pgSiteSearch.setASFormat();t&&(pgSiteSearch.ASObject.floater.innerHTML='<div class="as_list">'+t+"<\/div>")},selectFromMouseClickInMatchItem:function(){pgSiteSearch.fillInputBox(),pgSiteSearch.ASObject.inputBox.focus(),pgSiteSearch.hideASFloater()},selectFromMouseClickOutOfMatchItem:function(){pgSiteSearch.hideASFloater()},getIndexFromElement:function(n){for(var t=0;n=n.previousSibling;)t++;return t},getSelectedItem:function(){var n=null;if(pgSiteSearch.ASObject.titleList!=null)for(i=0;i<pgSiteSearch.ASObject.titleList.length&&!n;i++)pgSiteSearch.ASObject.titleList[i].isSelected&&(n=i);return n},setSelectedItem:function(n){pgSiteSearch.ASObject.titleList[n].isSelected=!0},setUnselectedItem:function(n){pgSiteSearch.ASObject.titleList[n].isSelected=!1},selectNextSDAS_MatchItem:function(){var n=pgSiteSearch.getSelectedItem(),t;n!=null?(pgSiteSearch.setUnselectedItem(n),n+1<pgSiteSearch.ASObject.titleList.length?pgSiteSearch.setSelectedItem(n+1):pgSiteSearch.setSelectedItem(0)):pgSiteSearch.setSelectedItem(0),t=pgSiteSearch.setASFormat(),t&&(pgSiteSearch.ASObject.floater.innerHTML='<div class="as_list">'+t+"<\/div>")},selectPreviousSDAS_MatchItem:function(){var n=pgSiteSearch.getSelectedItem(),t;n!=null?(pgSiteSearch.setUnselectedItem(n),n-1>=0?pgSiteSearch.setSelectedItem(n-1):pgSiteSearch.setSelectedItem(pgSiteSearch.ASObject.titleList.length-1)):pgSiteSearch.setSelectedItem(pgSiteSearch.ASObject.titleList.length-1),t=pgSiteSearch.setASFormat(),t&&(pgSiteSearch.ASObject.floater.innerHTML='<div class="as_list">'+t+"<\/div>")},fillInputBox:function(){var n,t;(n=pgSiteSearch.getSelectedItem())!=null&&(t=pgSiteSearch.ASObject.titleList[n].value,pgSiteSearch.ASObject.inputBox.value=t,_ge("in_url").value=pgSiteSearch.ASObject.urlList[n].value,this.isUrlClickFirst=!0,_ge("in_url").className="input_InputBox",pgSiteSearch.hideASFloater())},ASWindow:function(){this.ASMaxNumber=3,this.customizedFloater=!1,this.floater=_ge("as_lt"),this.selectedAS_Item=null,this.isGecko=navigator.userAgent.indexOf("Gecko/200")!=-1,this.isSafari=navigator.userAgent.indexOf("Safari")!=-1,this.showCredit=!1},init:function(){sj_be(document,"mouseup",this.handleClick),sj_be(_ge("pg_as"),"mouseover",this.handleMouseOver),pgSiteSearch.siteCode="%EE%81%9A",inputs=document.getElementsByTagName("input"),sj_be(_ge("in_tl"),"keydown",this.handleKeyDown),sj_be(_ge("in_tl"),"keyup",this.handleKeyPress),sj_be(_ge("in_url"),"keydown",this.handleKeyDown),sj_be(_ge("in_url"),"keyup",this.handleKeyPress),pgSiteSearch.ASObject||(pgSiteSearch.ASObject=new pgSiteSearch.ASWindow),pgSiteSearch.hideASFloater()}}